<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <link rel="icon" type="image/svg+xml" href="/images/vite.svg" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Takennlijst</title>
  <link rel="stylesheet" crossorigin href="/assets/main-C6ngJt34.css">
</head>
<body>
<header id="pagetitle">Taken</header>
<main>
  <section class="left-section">
    <div class="completed-container">
      <p class="section-title">Afgevinkte Taken</p>
      <!-- Content for Completed Taken can be added here -->
    </div>
  </section>
  <section class="right-section">
    <p class="section-title">To-Do Taken</p>
    <div class="to-do-container">
      <button onclick="render()">Toon taken</button>
      <template id="taskTemplate">
        <article class="taak">
          <time class="gemaaktOp" datetime="">Datum</time>
          <time class="vervaltijd" datetime="">Verval datum</time>
          <p class="name">Taak titel</p>
          <p class="description">Omschrijving</p>
          <p class="type">Type</p>
          <input type="checkbox" id="aanvinken" name="completed">
        </article>
      </template>
    </div>
  </section>
</main>
<form>
  <button class="addBtn" type="submit" formaction="addTask.html">+</button>
</form>
<dialog>
  <time dateTime="YYYY-MM-DD">Datum</time>
  <time vervaltijd="YYYY-MM-DD">Verval datum</time>
  <p>
    <button id="editBtn" alt="aanpassen"></button>
    <button id="delBtn" alt="verwijderen"></button>
  </p>
  <p class="description">Omschrijving</p>
  <p class="type">Type</p>
</dialog>
<script>
  function getTaken() {
    return fetch("http://localhost:8080/restservices/taken")
            .then(response => {
              if (!response.ok) {
                throw new Error(`HTTP error! Status: ${response.status}`);
              }
              return response.json();
            })
            .then(taken => {
              return taken;
            })
            .catch(error => {
              console.error("Error fetching tasks:", error);
              return [];
            });
  }

  function render() {
    let tasksElement = document.querySelector(".to-do-container");
    let taskTemplate = document.getElementById("taskTemplate");

    if (!tasksElement || !taskTemplate) {
      console.error("Element with class 'to-do-container' or template not found in the DOM.");
      return;
    }

    getTaken()
            .then(taken => {
              tasksElement.innerHTML = ""; // Clear existing content

              taken.forEach(taak => {
                let clone = taskTemplate.content.cloneNode(true);

                let gemaaktOpElement = clone.querySelector(".gemaaktOp");
                gemaaktOpElement.setAttribute("datetime", taak.gemaaktOp || '');
                gemaaktOpElement.textContent = taak.gemaaktOp
                        ? new Date(taak.gemaaktOp).toLocaleDateString('nl-NL')
                        : 'Geen datum';

                let vervaltimeElement = clone.querySelector(".vervaltijd");
                vervaltimeElement.setAttribute("datetime", taak.vervalDatum || '');
                vervaltimeElement.textContent = taak.vervalDatum
                        ? new Date(taak.vervalDatum).toLocaleDateString('nl-NL')
                        : 'Geen vervaldatum';

                let h2Element = clone.querySelector(".name");
                h2Element.textContent = taak.naamTaak || 'Geen titel'; // Controleer deze regel

                let descriptionElement = clone.querySelector(".description");
                descriptionElement.textContent = taak.omschrijving || 'Geen omschrijving';

                let typeElement = clone.querySelector(".type");
                typeElement.textContent = taak.type || 'Geen type';

                tasksElement.appendChild(clone);
              });
            })
            .catch(error => {
              console.error("Error rendering tasks:", error);
            });
  }

  document.addEventListener("DOMContentLoaded", () => {
    let button = document.querySelector("button");
    button.addEventListener("click", render);
  });
</script>
</body>
</html>
